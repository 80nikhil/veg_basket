<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Veg Basket - Inventory Management</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f4f7f6;
      }
      .table img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid #ddd;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .btn-add {
        background-color: #28a745;
        color: white;
        font-weight: 600;
      }
      .btn-add:hover {
        color: white;
        opacity: 0.9;
      }
    </style>
  </head>
  <body class="py-5">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="fw-bold text-dark">Vegetable Inventory</h2>
          <p class="text-muted">
            Manage your stock, prices, and product photos
          </p>
        </div>
        <div class="d-flex gap-2">
          <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary px-4"
            >Dashboard</a
          >
          <a href="{% url 'product_add' %}" class="btn btn-add px-4"
            >+ Add New Vegetable</a
          >
        </div>
      </div>

      <form
        action="{% url 'logout_admin' %}"
        method="post"
        style="display: inline"
      >
        {% csrf_token %}
        <button type="submit" class="btn btn-outline-danger px-3 mb-4">
          Logout
        </button>
      </form>

      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Image</th>
              <th>Vegetable Name</th>
              <th>Price</th>
              <th>Stock Status</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for product in products %}
            <tr>
              <td>
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" />
                {% else %}
                <div
                  class="bg-light text-center d-flex align-items-center justify-content-center"
                  style="
                    width: 60px;
                    height: 60px;
                    border-radius: 8px;
                    font-size: 10px;
                    color: #999;
                  "
                >
                  No Image
                </div>
                {% endif %}
              </td>
              <td>
                <span class="fw-bold">{{ product.name }}</span><br />
                <small class="text-muted"
                  >{{ product.description|truncatechars:40 }}</small
                >
              </td>
              <td>â‚¹{{ product.price }}</td>
              <td>
                {% if product.stock > 10 %}
                <span class="badge bg-success-subtle text-success"
                  >In Stock ({{ product.stock }} kg)</span
                >
                {% elif product.stock > 0 %}
                <span class="badge bg-warning-subtle text-warning"
                  >Low Stock ({{ product.stock }} kg)</span
                >
                {% else %}
                <span class="badge bg-danger-subtle text-danger"
                  >Out of Stock</span
                >
                {% endif %}
              </td>
              <td class="text-center">
                <div class="btn-group" role="group">
                  <a
                    href="{% url 'product_edit' product.pk %}"
                    class="btn btn-outline-primary btn-sm px-3"
                    >Edit</a
                  >

                  <button
                    type="button"
                    class="btn btn-outline-danger btn-sm px-3"
                    data-bs-toggle="modal"
                    data-bs-target="#deleteModal{{ product.pk }}"
                  >
                    Delete
                  </button>
                </div>
              </td>
            </tr>

            <div
              class="modal fade"
              id="deleteModal{{ product.pk }}"
              tabindex="-1"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Confirm Delete</h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to delete
                    <strong>{{ product.name }}</strong>?
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Cancel
                    </button>
                    <form
                      action="{% url 'product_delete' product.pk %}"
                      method="post"
                      style="display: inline"
                    >
                      {% csrf_token %}
                      <button type="submit" class="btn btn-danger">
                        Yes, Delete
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>

            {% empty %}
            <tr>
              <td colspan="5" class="text-center py-5 text-muted">
                No products found. Click the green button to add your first
                vegetable!
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
